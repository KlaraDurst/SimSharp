<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">

  <title>GasStationRefueling</title>
  <meta name="description" content="SimSharp Visualization Player">
  <meta name="author" content="KlaraDurst">

  <link rel="stylesheet" href="css/styles.css?v=1.0">
</head>

<body> 
  <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
  <svg id="canvas" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" onload="init()">
    <script>
      var svgDocument;
      var svgns;
      var timePerFrame;
      var it;
      var timeWhenLastUpdate;
      var timeFromLastUpdate;

      function init() {
        var json = JSON.parse(data);
        var frames = json["frames"];

        svgDocument = document.getElementById('canvas');
        if (json.hasOwnProperty('width') && json.hasOwnProperty('height')) {
          svgDocument.setAttributeNS(null, 'width', json['width']);
          svgDocument.setAttributeNS(null, 'height', json['height']);
          if (json.hasOwnProperty('startX') && json.hasOwnProperty('startY'))
            svgDocument.setAttributeNS(null, 'viewBox', json['startX'].toString().concat(" ", json['startY'].toString(), " ", json['width'].toString(), " ", json['height'].toString()));
        }

        svgns = "http://www.w3.org/2000/svg";
        timePerFrame = json["timeStep"] * 1000;
        it = makeFrameIterator(frames);

        window.requestAnimationFrame(animate);
      }

      function animate(timestamp) {
        if (!timeWhenLastUpdate)
          timeWhenLastUpdate = timestamp;

        timeFromLastUpdate = timestamp - timeWhenLastUpdate;
        if (timeFromLastUpdate > timePerFrame) {
          let result = it.next(); 
          if (!result.done) {
            Object.keys(result.value).forEach(e => updateObj(e, result.value[e]));
          }
          timeWhenLastUpdate = timestamp;
        }
        window.requestAnimationFrame(animate);
      }

      function updateObj(key, value) {
        let shape = document.getElementById(key);
        if (shape == null) {
          shape = document.createElementNS(svgns, value['type']);
          shape.setAttributeNS(null, "id", key);
          svgDocument.appendChild(shape);
        }
        Object.keys(value).forEach(e => updateAttr(shape, e, value[e]));
      }

      function updateAttr(shape, key, value) {
        if (key == 'visibility') {
          if (value)
            value = 'visible';
          else
            value = 'hidden';
        }
        shape.setAttributeNS(null, key, value);
      }

      function makeFrameIterator(frames) {
        let nextIndex = 0;
    
        const frameIterator = {
           next: function() {
               let result;
               if (frames.length > nextIndex) {
                   result = { value: frames[nextIndex], done: false }
                   nextIndex += 1;
                   return result;
               }
               return { value: frames.length, done: true }
           }
        };
        return frameIterator;
      }

      data = '{"name":"Gas Station Refuelling","timeStep":1.0,"width":1000,"height":1000,"startX":0,"startY":0,"frames":[{"fuelPumpTank":{"type":"rect","fill":"black","stroke":"black","strokeWidth":1,"visibility":true,"x":400,"y":650,"width":250,"height":200},"fuelPump":{"type":"rect","fill":"none","stroke":"black","strokeWidth":1,"visibility":true,"x":400,"y":650,"width":250,"height":200},"gasStationRight":{"type":"rect","fill":"grey","stroke":"grey","strokeWidth":1,"visibility":true,"x":500,"y":400,"width":50,"height":100},"gasStationLeft":{"type":"rect","fill":"grey","stroke":"grey","strokeWidth":1,"visibility":true,"x":300,"y":400,"width":50,"height":100}},{},{},{},{},{},{"Car1Tank":{"type":"rect","fill":"yellow","stroke":"yellow","strokeWidth":1,"visibility":true,"x":275,"y":275,"width":0,"height":50},"Car1":{"type":"rect","fill":"none","stroke":"yellow","strokeWidth":1,"visibility":true,"x":293,"y":275,"width":36,"height":50},"fuelPumpTank":{"y":632,"height":164}},{"Car1Tank":{"x":276,"width":2}},{"Car1Tank":{"x":277,"width":4}},{"Car1Tank":{"x":278,"width":6}},{"Car1Tank":{"x":279,"width":8}},{"Car1Tank":{"x":280,"width":11}},{"Car1Tank":{"x":281,"width":13}},{"Car1Tank":{"x":282,"width":15}},{"Car1Tank":{"x":283,"width":17}},{"Car1Tank":{"x":285,"width":19}},{"Car1Tank":{"x":286,"width":21}},{"Car1Tank":{"x":287,"width":23}},{"Car1Tank":{"x":288,"width":25}},{"Car1Tank":{"x":289,"width":28}},{"Car1Tank":{"x":290,"width":30}},{"Car1Tank":{"x":291,"width":32}},{"Car1Tank":{"x":292,"width":34}},{"Car1Tank":{"x":293,"width":36}},{"Car1Tank":{"visibility":false},"Car1":{"visibility":false}},{},{},{},{},{},{"Car2Tank":{"type":"rect","fill":"yellow","stroke":"yellow","strokeWidth":1,"visibility":true,"x":275,"y":275,"width":0,"height":50},"Car2":{"type":"rect","fill":"none","stroke":"yellow","strokeWidth":1,"visibility":true,"x":287,"y":275,"width":25,"height":50},"fuelPumpTank":{"y":620,"height":140}},{"Car2Tank":{"x":276,"width":2}},{"Car2Tank":{"x":277,"width":4}},{"Car2Tank":{"x":278,"width":6}},{"Car2Tank":{"x":279,"width":8}},{"Car2Tank":{"x":280,"width":10}},{"Car2Tank":{"x":281,"width":12}},{"Car2Tank":{"x":282,"width":15}},{"Car2Tank":{"x":283,"width":17}},{"Car2Tank":{"x":284,"width":19}},{"Car2Tank":{"x":285,"width":21}},{"Car2Tank":{"x":286,"width":23}},{"Car2Tank":{"visibility":false},"Car2":{"visibility":false}},{},{},{},{},{},{"Car3Tank":{"type":"rect","fill":"yellow","stroke":"yellow","strokeWidth":1,"visibility":true,"x":275,"y":275,"width":0,"height":50},"Car3":{"type":"rect","fill":"none","stroke":"yellow","strokeWidth":1,"visibility":true,"x":289,"y":275,"width":28,"height":50},"fuelPumpTank":{"y":606,"height":111}},{"Car3Tank":{"x":276,"width":2}},{"Car3Tank":{"x":277,"width":4}},{"Car3Tank":{"x":278,"width":6}},{"Car3Tank":{"x":279,"width":8}},{"Car3Tank":{"x":280,"width":10}},{"Car3Tank":{"x":281,"width":12}},{"Car3Tank":{"x":282,"width":14}},{"Car3Tank":{"x":283,"width":16}},{"Car3Tank":{"x":284,"width":18}},{"Car3Tank":{"x":285,"width":20}},{"Car3Tank":{"x":286,"width":22}},{"Car3Tank":{"x":287,"width":24}},{"Car3Tank":{"x":288,"width":26}},{"Car3Tank":{"visibility":false},"Car3":{"visibility":false}},{},{},{},{},{},{"Car4Tank":{"type":"rect","fill":"yellow","stroke":"yellow","strokeWidth":1,"visibility":true,"x":275,"y":275,"width":0,"height":50},"Car4":{"type":"rect","fill":"none","stroke":"yellow","strokeWidth":1,"visibility":true,"x":292,"y":275,"width":35,"height":50},"fuelPumpTank":{"y":588,"height":76}},{"Car4Tank":{"x":276,"width":2}},{"Car4Tank":{"x":277,"width":4}},{"Car4Tank":{"x":278,"width":6}},{"Car4Tank":{"x":279,"width":8}},{"Car4Tank":{"x":280,"width":10}},{"Car4Tank":{"x":281,"width":12}},{"Car4Tank":{"x":282,"width":14}},{"Car4Tank":{"x":283,"width":16}},{"Car4Tank":{"x":284,"width":19}},{"Car4Tank":{"x":285,"width":21}},{"Car4Tank":{"x":286,"width":23}},{"Car4Tank":{"x":287,"width":25}},{"Car4Tank":{"x":288,"width":27}},{"Car4Tank":{"x":289,"width":29}},{"Car4Tank":{"x":290,"width":31}},{"Car4Tank":{"x":291,"width":33}},{"Car4Tank":{"x":292,"width":35}},{"Car4Tank":{"visibility":false},"Car4":{"visibility":false}},{},{},{},{},{},{"Car5Tank":{"type":"rect","fill":"yellow","stroke":"yellow","strokeWidth":1,"visibility":true,"x":275,"y":275,"width":0,"height":50},"Car5":{"type":"rect","fill":"none","stroke":"yellow","strokeWidth":1,"visibility":true,"x":290,"y":275,"width":30,"height":50},"fuelPumpTank":{"y":573,"height":46}},{"Car5Tank":{"x":276,"width":2}},{"Car5Tank":{"x":277,"width":4}},{"Car5Tank":{"x":278,"width":6}},{"Car5Tank":{"x":279,"width":8}},{"Car5Tank":{"x":280,"width":10}},{"Car5Tank":{"x":281,"width":12}},{"Car5Tank":{"x":282,"width":14}},{"Car5Tank":{"x":283,"width":16}},{"Car5Tank":{"x":284,"width":18}},{"Car5Tank":{"x":285,"width":20}},{"Car5Tank":{"x":286,"width":22}},{"Car5Tank":{"x":287,"width":24}},{"Car5Tank":{"x":288,"width":26}},{"Car5Tank":{"x":289,"width":28}},{"Car5Tank":{"visibility":false},"Car5":{"visibility":false}},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{}]}'
    </script>
  </svg>

</body>

</html>