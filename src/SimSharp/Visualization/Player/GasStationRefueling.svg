<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg id="canvas" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100%" height="100%" onload="init()">
    <script>
      var svgDocument;
      var svgns;
      var timePerFrame;
      var it;
      var timeWhenLastUpdate;
      var timeFromLastUpdate;

      function init() {
        let json = JSON.parse(data);
        let frames = json["frames"];

        svgDocument = document.getElementById('canvas');
        svgns = "http://www.w3.org/2000/svg";
        timePerFrame = 1000 / json["fps"];
        it = makeFrameIterator(frames);

        if (json.hasOwnProperty('width')) {
          if (json.hasOwnProperty('height')) {
            if (json.hasOwnProperty('startX')) {
              if (json.hasOwnProperty('startY'))
                svgDocument.setAttribute('viewBox', json['startX'].toString().concat(" ", json['startY'].toString(), " ", json['width'].toString(), " ", json['height'].toString()));
            }
          }
        }

        window.requestAnimationFrame(animate);
      }

      function animate(timestamp) {
        if (!timeWhenLastUpdate)
          timeFromLastUpdate = timePerFrame + 1;
        else
          timeFromLastUpdate = timestamp - timeWhenLastUpdate;
          
        if (timeFromLastUpdate > timePerFrame) {
          let result = it.next(); 
          if (!result.done) {
            Object.keys(result.value).forEach(e => updateObj(e, result.value[e]));
          }
          timeWhenLastUpdate = timestamp;
        }
        window.requestAnimationFrame(animate);
      }

      function updateObj(key, value) {
        let shape = document.getElementById(key);
        if (shape == null) {
          shape = document.createElementNS(svgns, value['type']);
          shape.setAttribute("id", key);
          svgDocument.appendChild(shape);
        }
        Object.keys(value).forEach(e => updateAttr(shape, e, value[e]));
      }

      function updateAttr(shape, key, value) {
        if (key == 'visibility') {
          if (value)
            value = 'visible';
          else
            value = 'hidden';
        }
        shape.setAttribute(key, value);
      }

      function makeFrameIterator(frames) {
        let nextIndex = 0;
    
        const frameIterator = {
           next: function() {
               let result;
               if (frames.length > nextIndex) {
                   result = { value: frames[nextIndex], done: false }
                   nextIndex += 1;
                   return result;
               }
               return { value: frames.length, done: true }
           }
        };
        return frameIterator;
      }

      data = '{"name":"Gas Station Refueling","fps":1.0,"width":1000,"height":1000,"startX":0,"startY":0,"frames":[{"fuelPumpTank":{"type":"rect","fill":"black","stroke":"black","strokeWidth":1,"visibility":true,"x":275,"y":550,"width":250,"height":200},"fuelPump":{"type":"rect","fill":"none","stroke":"black","strokeWidth":1,"visibility":true,"x":275,"y":550,"width":250,"height":200},"gasStationRight":{"type":"rect","fill":"grey","stroke":"grey","strokeWidth":1,"visibility":true,"x":475,"y":350,"width":50,"height":100},"gasStationLeft":{"type":"rect","fill":"grey","stroke":"grey","strokeWidth":1,"visibility":true,"x":275,"y":350,"width":50,"height":100}},{},{},{},{},{},{"Car1Tank":{"type":"rect","fill":"yellow","stroke":"yellow","strokeWidth":1,"visibility":true,"x":275,"y":250,"width":0,"height":50},"Car1":{"type":"rect","fill":"none","stroke":"yellow","strokeWidth":1,"visibility":true,"x":275,"y":250,"width":36,"height":50},"fuelPumpTank":{"y":586,"height":164}},{"Car1Tank":{"width":2}},{"Car1Tank":{"width":4}},{"Car1Tank":{"width":6}},{"Car1Tank":{"width":8}},{"Car1Tank":{"width":11}},{"Car1Tank":{"width":13}},{"Car1Tank":{"width":15}},{"Car1Tank":{"width":17}},{"Car1Tank":{"width":19}},{"Car1Tank":{"width":21}},{"Car1Tank":{"width":23}},{"Car1Tank":{"width":25}},{"Car1Tank":{"width":28}},{"Car1Tank":{"width":30}},{"Car1Tank":{"width":32}},{"Car1Tank":{"width":34}},{"Car1Tank":{"width":36}},{"Car1Tank":{"visibility":false},"Car1":{"visibility":false}},{},{},{},{},{},{"Car2Tank":{"type":"rect","fill":"yellow","stroke":"yellow","strokeWidth":1,"visibility":true,"x":275,"y":250,"width":0,"height":50},"Car2":{"type":"rect","fill":"none","stroke":"yellow","strokeWidth":1,"visibility":true,"x":275,"y":250,"width":25,"height":50},"fuelPumpTank":{"y":610,"height":140}},{"Car2Tank":{"width":2}},{"Car2Tank":{"width":4}},{"Car2Tank":{"width":6}},{"Car2Tank":{"width":8}},{"Car2Tank":{"width":10}},{"Car2Tank":{"width":12}},{"Car2Tank":{"width":15}},{"Car2Tank":{"width":17}},{"Car2Tank":{"width":19}},{"Car2Tank":{"width":21}},{"Car2Tank":{"width":23}},{"Car2Tank":{"visibility":false},"Car2":{"visibility":false}},{},{},{},{},{},{"Car3Tank":{"type":"rect","fill":"yellow","stroke":"yellow","strokeWidth":1,"visibility":true,"x":275,"y":250,"width":0,"height":50},"Car3":{"type":"rect","fill":"none","stroke":"yellow","strokeWidth":1,"visibility":true,"x":275,"y":250,"width":28,"height":50},"fuelPumpTank":{"y":639,"height":111}},{"Car3Tank":{"width":2}},{"Car3Tank":{"width":4}},{"Car3Tank":{"width":6}},{"Car3Tank":{"width":8}},{"Car3Tank":{"width":10}},{"Car3Tank":{"width":12}},{"Car3Tank":{"width":14}},{"Car3Tank":{"width":16}},{"Car3Tank":{"width":18}},{"Car3Tank":{"width":20}},{"Car3Tank":{"width":22}},{"Car3Tank":{"width":24}},{"Car3Tank":{"width":26}},{"Car3Tank":{"visibility":false},"Car3":{"visibility":false}},{},{},{},{},{},{"Car4Tank":{"type":"rect","fill":"yellow","stroke":"yellow","strokeWidth":1,"visibility":true,"x":275,"y":250,"width":0,"height":50},"Car4":{"type":"rect","fill":"none","stroke":"yellow","strokeWidth":1,"visibility":true,"x":275,"y":250,"width":35,"height":50},"fuelPumpTank":{"y":674,"height":76}},{"Car4Tank":{"width":2}},{"Car4Tank":{"width":4}},{"Car4Tank":{"width":6}},{"Car4Tank":{"width":8}},{"Car4Tank":{"width":10}},{"Car4Tank":{"width":12}},{"Car4Tank":{"width":14}},{"Car4Tank":{"width":16}},{"Car4Tank":{"width":19}},{"Car4Tank":{"width":21}},{"Car4Tank":{"width":23}},{"Car4Tank":{"width":25}},{"Car4Tank":{"width":27}},{"Car4Tank":{"width":29}},{"Car4Tank":{"width":31}},{"Car4Tank":{"width":33}},{"Car4Tank":{"width":35}},{"Car4Tank":{"visibility":false},"Car4":{"visibility":false}},{},{},{},{},{},{"Car5Tank":{"type":"rect","fill":"yellow","stroke":"yellow","strokeWidth":1,"visibility":true,"x":275,"y":250,"width":0,"height":50},"Car5":{"type":"rect","fill":"none","stroke":"yellow","strokeWidth":1,"visibility":true,"x":275,"y":250,"width":30,"height":50},"fuelPumpTank":{"y":704,"height":46}},{"Car5Tank":{"width":2}},{"Car5Tank":{"width":4}},{"Car5Tank":{"width":6}},{"Car5Tank":{"width":8}},{"Car5Tank":{"width":10}},{"Car5Tank":{"width":12}},{"Car5Tank":{"width":14}},{"Car5Tank":{"width":16}},{"Car5Tank":{"width":18}},{"Car5Tank":{"width":20}},{"Car5Tank":{"width":22}},{"Car5Tank":{"width":24}},{"Car5Tank":{"width":26}},{"Car5Tank":{"width":28}},{"Car5Tank":{"visibility":false},"Car5":{"visibility":false}}]}'
    </script>
</svg>
